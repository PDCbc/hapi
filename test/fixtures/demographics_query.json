{
  "_id": {
    "$oid": "558b2b24adf722c9e61f5c51"
  },
  "title": "PDC-001",
  "_type": "Query",
  "user_id": {
    "$oid": "5575e2bcecc133629d9d86b9"
  },
  "description": "PDC-001_population-map",
  "reduce": "function reduce(key, values){return Array.sum(values);}",
  "map": "/**\n * Query Title: PDC-001\n * Query Type:  Pyramid\n * Description: Population Pyramid\n */\nfunction map( patient ){\n  //constants\n  var gdrs = [\"female_\", \"male_\", \"undifferentiated_\", \"undefined_\"];\n\n  // Store physician ID, via JSON key\n  var pid = \"_\" + patient.json.primary_care_provider_id;\n\n  //Store age and gender, via patient Object functions\n  var age = patient.age();\n  var gdr = patient.gender();\n\n  // Convert gdr to an expected value\n  if( gdr && gdr.toString().toUpperCase() === \"F\" )\n    gdr = \"female_\";\n  else if( gdr && gdr.toString().toUpperCase() === \"M\" )\n    gdr = \"male_\";\n  else if( gdr && gdr.toString().toUpperCase() === \"UN\" )\n    gdr = \"undifferentiated_\";\n  else\n    gdr = \"undefined_\";\n\n  // Edge cases assigned -1 (out of specified ranges)\n  if( typeof age !== 'number' || age < 0 ){\n    return;\n  }\n\n  // Emit for 90+ special case\n  if( age >= 90 )\n    emit( gdr + \"90+\" + pid, 1 );\n  else\n    emit( gdr + \"90+\" + pid, 0 );\n\n  gdrs.forEach(\n    function(x)\n    {\n      emit(x + \"90+\" + pid, 0);\n    }\n  );\n\n  // Emit for remaining ranges (10 yrs, descending)\n  for( var i = 80; i >= 0; i-=10 ){\n    var range = i + \"-\" +( i + 9 );\n    if( age >= i && age <( i + 10 ))\n      emit( gdr + range + pid, 1 );\n    for(var j=0; j<gdrs.length; j++)\n    {\n      emit(gdrs[j] + range + pid, 0);\n    }\n  }\n}\n",
  "__v": 0,
  "executions": [
    {
      "time": 1422804816,
      "aggregate_result": {
        "female_0-9_cpsid": 0,
        "female_10-19_cpsid": 0,
        "female_20-29_cpsid": 0,
        "female_30-39_cpsid": 0,
        "female_40-49_cpsid": 1,
        "female_50-59_cpsid": 1,
        "female_60-69_cpsid": 1,
        "female_70-79_cpsid": 1,
        "female_80-89_cpsid": 2,
        "female_90+_cpsid": 2,
        "male_0-9_cpsid": 1,
        "male_10-19_cpsid": 3,
        "male_20-29_cpsid": 4,
        "male_30-39_cpsid": 5,
        "male_40-49_cpsid": 5,
        "male_50-59_cpsid": 5,
        "male_60-69_cpsid": 2,
        "male_70-79_cpsid": 3,
        "male_80-89_cpsid": 0,
        "male_90+_cpsid": 1,
        "undefined_0-9_cpsid": 1,
        "undefined_10-19_cpsid": 0,
        "undefined_20-29_cpsid": 0,
        "undefined_30-39_cpsid": 0,
        "undefined_40-49_cpsid": 0,
        "undefined_50-59_cpsid": 0,
        "undefined_60-69_cpsid": 0,
        "undefined_70-79_cpsid": 0,
        "undefined_80-89_cpsid": 0,
        "undefined_90+_cpsid": 0,
        "undifferentiated_0-9_cpsid": 0,
        "undifferentiated_10-19_cpsid": 0,
        "undifferentiated_20-29_cpsid": 0,
        "undifferentiated_30-39_cpsid": 0,
        "undifferentiated_40-49_cpsid": 1,
        "undifferentiated_50-59_cpsid": 2,
        "undifferentiated_60-69_cpsid": 3,
        "undifferentiated_70-79_cpsid": 3,
        "undifferentiated_80-89_cpsid": 0,
        "undifferentiated_90+_cpsid": 0,
        "female_0-9_cpsid2": 0,
        "female_10-19_cpsid2": 0,
        "female_20-29_cpsid2": 0,
        "female_30-39_cpsid2": 0,
        "female_40-49_cpsid2": 0,
        "female_50-59_cpsid2": 0,
        "female_60-69_cpsid2": 0,
        "female_70-79_cpsid2": 0,
        "female_80-89_cpsid2": 0,
        "female_90+_cpsid2": 0,
        "male_0-9_cpsid2": 0,
        "male_10-19_cpsid2": 0,
        "male_20-29_cpsid2": 0,
        "male_30-39_cpsid2": 0,
        "male_40-49_cpsid2": 0,
        "male_50-59_cpsid2": 0,
        "male_60-69_cpsid2": 0,
        "male_70-79_cpsid2": 0,
        "male_80-89_cpsid2": 0,
        "male_90+_cpsid2": 0,
        "undefined_0-9_cpsid2": 1,
        "undefined_10-19_cpsid2": 0,
        "undefined_20-29_cpsid2": 0,
        "undefined_30-39_cpsid2": 0,
        "undefined_40-49_cpsid2": 0,
        "undefined_50-59_cpsid2": 0,
        "undefined_60-69_cpsid2": 0,
        "undefined_70-79_cpsid2": 0,
        "undefined_80-89_cpsid2": 0,
        "undefined_90+_cpsid2": 0,
        "undifferentiated_0-9_cpsid2": 0,
        "undifferentiated_10-19_cpsid2": 0,
        "undifferentiated_20-29_cpsid2": 0,
        "undifferentiated_30-39_cpsid2": 0,
        "undifferentiated_40-49_cpsid2": 0,
        "undifferentiated_50-59_cpsid2": 0,
        "undifferentiated_60-69_cpsid2": 0,
        "undifferentiated_70-79_cpsid2": 0,
        "undifferentiated_80-89_cpsid2": 0,
        "undifferentiated_90+_cpsid2": 0,
        "female_0-9_cpsid4": 0,
        "female_10-19_cpsid4": 0,
        "female_20-29_cpsid4": 0,
        "female_30-39_cpsid4": 0,
        "female_40-49_cpsid4": 0,
        "female_50-59_cpsid4": 0,
        "female_60-69_cpsid4": 0,
        "female_70-79_cpsid4": 0,
        "female_80-89_cpsid4": 0,
        "female_90+_cpsid4": 0,
        "male_0-9_cpsid4": 0,
        "male_10-19_cpsid4": 0,
        "male_20-29_cpsid4": 0,
        "male_30-39_cpsid4": 0,
        "male_40-49_cpsid4": 0,
        "male_50-59_cpsid4": 0,
        "male_60-69_cpsid4": 0,
        "male_70-79_cpsid4": 0,
        "male_80-89_cpsid4": 0,
        "male_90+_cpsid4": 0,
        "undefined_0-9_cpsid4": 1,
        "undefined_10-19_cpsid4": 0,
        "undefined_20-29_cpsid4": 0,
        "undefined_30-39_cpsid4": 0,
        "undefined_40-49_cpsid4": 0,
        "undefined_50-59_cpsid4": 0,
        "undefined_60-69_cpsid4": 0,
        "undefined_70-79_cpsid4": 0,
        "undefined_80-89_cpsid4": 0,
        "undefined_90+_cpsid4": 0,
        "undifferentiated_0-9_cpsid4": 0,
        "undifferentiated_10-19_cpsid4": 0,
        "undifferentiated_20-29_cpsid4": 0,
        "undifferentiated_30-39_cpsid4": 0,
        "undifferentiated_40-49_cpsid4": 0,
        "undifferentiated_50-59_cpsid4": 0,
        "undifferentiated_60-69_cpsid4": 0,
        "undifferentiated_70-79_cpsid4": 0,
        "undifferentiated_80-89_cpsid4": 0,
        "undifferentiated_90+_cpsid4": 0
      }
    },
    {
      "time": 1420126416,
      "aggregate_result": {
        "female_0-9_cpsid": 0,
        "female_10-19_cpsid": 0,
        "female_20-29_cpsid": 0,
        "female_30-39_cpsid": 0,
        "female_40-49_cpsid": 2,
        "female_50-59_cpsid": 2,
        "female_60-69_cpsid": 2,
        "female_70-79_cpsid": 2,
        "female_80-89_cpsid": 2,
        "female_90+_cpsid": 2,
        "male_0-9_cpsid": 0,
        "male_10-19_cpsid": 0,
        "male_20-29_cpsid": 0,
        "male_30-39_cpsid": 5,
        "male_40-49_cpsid": 5,
        "male_50-59_cpsid": 5,
        "male_60-69_cpsid": 4,
        "male_70-79_cpsid": 3,
        "male_80-89_cpsid": 2,
        "male_90+_cpsid": 1,
        "undefined_0-9_cpsid": 0,
        "undefined_10-19_cpsid": 0,
        "undefined_20-29_cpsid": 0,
        "undefined_30-39_cpsid": 0,
        "undefined_40-49_cpsid": 0,
        "undefined_50-59_cpsid": 0,
        "undefined_60-69_cpsid": 0,
        "undefined_70-79_cpsid": 0,
        "undefined_80-89_cpsid": 0,
        "undefined_90+_cpsid": 0,
        "undifferentiated_0-9_cpsid": 0,
        "undifferentiated_10-19_cpsid": 0,
        "undifferentiated_20-29_cpsid": 0,
        "undifferentiated_30-39_cpsid": 0,
        "undifferentiated_40-49_cpsid": 0,
        "undifferentiated_50-59_cpsid": 0,
        "undifferentiated_60-69_cpsid": 0,
        "undifferentiated_70-79_cpsid": 0,
        "undifferentiated_80-89_cpsid": 0,
        "undifferentiated_90+_cpsid": 0,
        "female_0-9_cpsid2": 0,
        "female_10-19_cpsid2": 0,
        "female_20-29_cpsid2": 1,
        "female_30-39_cpsid2": 1,
        "female_40-49_cpsid2": 1,
        "female_50-59_cpsid2": 2,
        "female_60-69_cpsid2": 2,
        "female_70-79_cpsid2": 3,
        "female_80-89_cpsid2": 3,
        "female_90+_cpsid2": 0,
        "male_0-9_cpsid2": 0,
        "male_10-19_cpsid2": 0,
        "male_20-29_cpsid2": 0,
        "male_30-39_cpsid2": 2,
        "male_40-49_cpsid2": 5,
        "male_50-59_cpsid2": 4,
        "male_60-69_cpsid2": 3,
        "male_70-79_cpsid2": 2,
        "male_80-89_cpsid2": 0,
        "male_90+_cpsid2": 0,
        "undefined_0-9_cpsid2": 1,
        "undefined_10-19_cpsid2": 0,
        "undefined_20-29_cpsid2": 0,
        "undefined_30-39_cpsid2": 0,
        "undefined_40-49_cpsid2": 0,
        "undefined_50-59_cpsid2": 0,
        "undefined_60-69_cpsid2": 0,
        "undefined_70-79_cpsid2": 0,
        "undefined_80-89_cpsid2": 0,
        "undefined_90+_cpsid2": 0,
        "undifferentiated_0-9_cpsid2": 0,
        "undifferentiated_10-19_cpsid2": 0,
        "undifferentiated_20-29_cpsid2": 0,
        "undifferentiated_30-39_cpsid2": 0,
        "undifferentiated_40-49_cpsid2": 0,
        "undifferentiated_50-59_cpsid2": 0,
        "undifferentiated_60-69_cpsid2": 0,
        "undifferentiated_70-79_cpsid2": 0,
        "undifferentiated_80-89_cpsid2": 0,
        "undifferentiated_90+_cpsid2": 0,
        "female_0-9_cpsid4": 0,
        "female_10-19_cpsid4": 0,
        "female_20-29_cpsid4": 0,
        "female_30-39_cpsid4": 0,
        "female_40-49_cpsid4": 0,
        "female_50-59_cpsid4": 0,
        "female_60-69_cpsid4": 0,
        "female_70-79_cpsid4": 0,
        "female_80-89_cpsid4": 0,
        "female_90+_cpsid4": 0,
        "male_0-9_cpsid4": 0,
        "male_10-19_cpsid4": 0,
        "male_20-29_cpsid4": 2,
        "male_30-39_cpsid4": 2,
        "male_40-49_cpsid4": 3,
        "male_50-59_cpsid4": 3,
        "male_60-69_cpsid4": 4,
        "male_70-79_cpsid4": 4,
        "male_80-89_cpsid4": 5,
        "male_90+_cpsid4": 0,
        "undefined_0-9_cpsid4": 1,
        "undefined_10-19_cpsid4": 0,
        "undefined_20-29_cpsid4": 0,
        "undefined_30-39_cpsid4": 0,
        "undefined_40-49_cpsid4": 0,
        "undefined_50-59_cpsid4": 0,
        "undefined_60-69_cpsid4": 0,
        "undefined_70-79_cpsid4": 0,
        "undefined_80-89_cpsid4": 0,
        "undefined_90+_cpsid4": 0,
        "undifferentiated_0-9_cpsid4": 0,
        "undifferentiated_10-19_cpsid4": 0,
        "undifferentiated_20-29_cpsid4": 0,
        "undifferentiated_30-39_cpsid4": 0,
        "undifferentiated_40-49_cpsid4": 0,
        "undifferentiated_50-59_cpsid4": 0,
        "undifferentiated_60-69_cpsid4": 0,
        "undifferentiated_70-79_cpsid4": 0,
        "undifferentiated_80-89_cpsid4": 0,
        "undifferentiated_90+_cpsid4": 0
      }
    }
  ]
}